# change-seat

![main](/images/main.gif)
https://change-seat.herokuapp.com/

## 목차
- [왜 만들었나?](#why)
- [어떻게 만들었나?](#how)
  - [기존 프로젝트에서 어떤 점이 바뀌었나?](#changed)
  - [프로젝트를 진행하면서 발생한 문제는 없었나?](#problem)
- [출처](#source)


## <a id="why"></a>왜 만들었나?

이 프로젝트는 고등학교 3학년 수업시간 과제로 처음 진행되었습니다.

과제의 주제는 **자리바꾸기**였습니다.

그 때는 [JSP로 프로젝트를 진행했었는데](https://github.com/Ahnteve/Seat) 과제를 발표했을 때 친구들과 선생님의 반응도 좋았고, 프로젝트를 진행할 때 즐겁게 개발을 했던 기억이 떠올라 'node.js로 다시 한번 만들어볼까?' 라는 생각이 들어 프로젝트를 진행하게 되었습니다.

## <a id="how"></a>어떻게 만들었나?

기존 프로젝트의 코드를 바탕으로 코드를 개선하고 몇 가지 새로운 기능을 추가하는 방향으로 개발을 진행했습니다.

### <a id="changed"></a>기존 프로젝트에서 어떤 점이 바뀌었나?

1. 자바스크립트에서 타입스크립트로
   - 기존 프로젝트는 html의 script 태그에 코드를 작성했었다
   - 모든 코드를 한 파일에 작성하다 보니 코드가 늘어날수록 코드를 보기가 힘들어지는 단점이 있었다
   - 타입스크립트가 컴파일 단계에서 오류를 표시해준다는 것을 듣고 타입스크립트를 이용해서 코드를 짜기로 결정!
   - 자바스크립트를 사용할 때보다 타입스크립트를 사용했을 때가 프로젝트를 진행하는 데 더 수월했다. 타입체크💗
2. 자리 저장 기능 업그레이드
   - 기존 프로젝트에서는 자리를 저장하면 학생의 목록만 저장했었다
   - 이번 프로젝트에서는 책상의 위치까지 저장하도록 변경했다
   - 기존 프로젝트에서는 저장 버튼을 누르면 서버에 있는 텍스트파일(...)에 학생 정보를 저장하고 코드를 발급해서 그 코드를 입력하면 불러오는 방식을 사용했다
   - 이번 프로젝트에서는 저장 버튼을 누르면 정보를 저장한 파일(ex. 20190406.seat)을 다운로드하게 하고 파일을 입력하면 불러오는 방식으로 변경했다
3. 자리 설정 기능 추가
   - 기존 프로젝트는 행(row)와 열(col)을 선택하면 개수에 맞춰 책상이 정해진 모양대로 만들어졌다
   - 이번에는 설정 모드를 만들어 사용자가 직접 책상 위치와 개수를 커스터마이징 할 수 있도록 변경했다

### <a id="problem"></a>프로젝트를 진행하면서 발생한 문제는 없었나?

사소한 문제들이 종종 발생했는데, 그중 가장 기억에 남는 문제는 캔버스의 이미지 로드 문제입니다.

![problem](/images/problem.gif)

학생이나 책상을 추가하면 캔버스에서 이미지를 최초로 불러올 때 이미지를 불러오기 전에 그리는 함수가 실행되어 이미지가 뒤늦게 출력되는 문제가 있었습니다

작년에 했던 프로젝트를 실행했을 때는 이 문제가 발생하지 않길래 어떻게 해결 코드를 작성했나 살펴보았습니다

```
setInterval(updateArea, 20);
```

기존 프로젝트에서는 0.02초마다 그리는 함수를 호출하고 있었습니다(...)

이 방법은 사용자가 아무런 행동을 하고 있지 않더라도 0.02초마다 그리는 함수를 호출하기 때문에 좋지 않은 방법인 것 같아 이 코드를 아래와 같이 개선했습니다

```
export const LoadImages = (imagefiles: string[]): Object => {
  const loadedImages: Object = {};

  imagefiles.forEach(imagefile => {
    let image = new Image();
    image.src = imagefile;
    loadedImages[imagefile] = image;
  });

  return loadedImages;
};
```

```
const loadedImages = LoadImages([
  'image/desk.png',
  'image/1.png',
  'image/2.png',
  'image/3.png',
  'image/4.png',
  'image/5.png',
  'image/6.png',
  'image/7.png',
  'image/8.png'
]);
```

이미지를 로드하는 함수를 작성하고, 프로그램이 시작될 때 이미지를 미리 로드하고 그 이미지를 Student와 Desk객체에 할당해 사용했습니다

이미지에 onload 이벤트를 걸어 이미지가 로드되면 그리는 방법도 생각해 봤지만

Student와 Desk객체의 draw함수는 Classroom 객체에서 넘겨준 ctx를 받아 함수를 실행하기 때문에 이 방법으로 대체했습니다 (ctx는 Classroom만 갖게 하고 싶었습니다 ㅎㅎ...)

## <a id="source"></a>출처

학생 이미지 : http://www.avatarsinpixels.com/
